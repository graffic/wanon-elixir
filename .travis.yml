language: elixir
elixir: '1.7'
otp_release: '21.0'
addons:
  postgresql: '9.4'
jobs:
  include:
    - &stage_test
      stage: test
      env: MIX_ENV=test
      services:
        - postgresql
      before_script:
        - psql -U postgres -c "ALTER USER postgres WITH PASSWORD 'mysecretpassword';"
      script:
        - mix coveralls.travis
    - <<: *stage_test
      env: MIX_ENV=integration
    - stage: deploy
      services:
        - docker
      env: MIX_ENV=prod
      script:
        - docker build -t wanon:latest .
